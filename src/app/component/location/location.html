<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaCWFWmJtjh3A6G9bo3PI7a3AyIKBlcf8&loading=async&libraries=maps&v=beta"
  defer
></script>

<div class="location-container">
  <div class="content-wrapper">

    <!-- Form Section -->
    <div class="form-section">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">Find Cell Tower Location</h2>
        </div>

        <form [formGroup]="form" (submit)="findLocation()" class="location-form">
          <div class="form-group">
            <label class="field-label">Phone Number *</label>
            <input
              class="form-input"
              type="number"
              required
              formControlName="phoneNumber"
              name="phoneNumber"
              placeholder="Enter phone number"
            />
            @if (form.get('phoneNumber')?.hasError('required') && form.get('phoneNumber')?.touched) {
              <div class="error-message">Phone number is required</div>
            }
            @if (form.get('phoneNumber')?.hasError('pattern') && form.get('phoneNumber')?.touched) {
              <div class="error-message">Please enter a valid phone number</div>
            }
          </div>

          <div class="form-group">
            <label class="field-label">MCC *</label>
            <input
              class="form-input"
              type="number"
              required
              formControlName="mcc"
              name="mcc"
              placeholder="Mobile Country Code"
            />
            @if (form.get('mcc')?.hasError('required') && form.get('mcc')?.touched) {
              <div class="error-message">MCC is required</div>
            }
          </div>

          <div class="form-group">
            <label class="field-label">MNC *</label>
            <input
              class="form-input"
              type="number"
              required
              formControlName="mnc"
              name="mnc"
              placeholder="Mobile Network Code"
            />
            @if (form.get('mnc')?.hasError('required') && form.get('mnc')?.touched) {
              <div class="error-message">MNC is required</div>
            }
          </div>

          <div class="form-group">
            <label class="field-label">LAC *</label>
            <input
              class="form-input"
              type="number"
              required
              formControlName="lac"
              name="lac"
              placeholder="Location Area Code"
            />
            @if (form.get('lac')?.hasError('required') && form.get('lac')?.touched) {
              <div class="error-message">LAC is required</div>
            }
          </div>

          <div class="form-group">
            <label class="field-label">CID *</label>
            <input
              class="form-input"
              type="number"
              required
              formControlName="cid"
              name="cid"
              placeholder="Cell ID"
            />
            @if (form.get('cid')?.hasError('required') && form.get('cid')?.touched) {
              <div class="error-message">CID is required</div>
            }
          </div>

          <div class="form-actions">
            <button
              type="submit"
              class="find-button"
              [disabled]="!form.valid || loading()"
            >
              @if (loading()) {
                <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
                <span>Finding...</span>
              } @else {
                <span>Find</span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Map Section -->
    @if (markerPosition.lat !== 0 || markerPosition.lng !== 0) {
      <div class="map-section">
        <div class="map-card">
          <div class="map-header">
            <h3 class="map-title">Location Found</h3>
            <div class="coordinates">
              <span class="coordinate-label">Coordinates:</span>
              <span class="coordinate-value">{{ markerPosition.lat | number:'1.6-6' }}, {{ markerPosition.lng | number:'1.6-6' }}</span>
            </div>
          </div>

          <div class="map-container">
            <google-map height="500px" width="100%" [options]="options" class="location-map">
              <map-advanced-marker
                #markElem="mapAdvancedMarker"
                [position]="{ lat: markerPosition.lat, lng: markerPosition.lng }"
                (mapClick)="showAddress(cellInfo, markElem)"
              ></map-advanced-marker>

              <map-info-window
                #infoWindow="mapInfoWindow"
                (closeclick)="infoWindowVisible = false"
              >
                <div class="info-window-content">
                  <h4 class="info-title">{{ selectedMarkerData?.address || 'Location Found' }}</h4>
                  <div class="info-details">
                    <p><strong>Latitude:</strong> {{ selectedMarkerData?.latitude | number:'1.6-6' }}</p>
                    <p><strong>Longitude:</strong> {{ selectedMarkerData?.longitude | number:'1.6-6' }}</p>
                    @if (selectedMarkerData?.phoneNumber) {
                      <p><strong>Phone:</strong> {{ selectedMarkerData?.phoneNumber }}</p>
                    }
                  </div>
                </div>
              </map-info-window>
            </google-map>
          </div>
        </div>
      </div>
    }
  </div>
</div>
